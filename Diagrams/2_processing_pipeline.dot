digraph ProcessingPipeline {
    rankdir=TB;
    splines=polyline;
    nodesep=0.6;
    ranksep=0.8;
    
    node [shape=box, style=filled, fontname="Arial", fontsize=10];
    
    // Input
    START [label="User Records\nQuran Recitation", shape=ellipse, fillcolor="#90EE90"];
    INPUT [label="Audio Input\n(WAV/MP3)", fillcolor="#FFE5B4"];
    
    // Preprocessing
    subgraph cluster_preprocess {
        label="Preprocessing Stage";
        style=filled;
        color=lightblue;
        
        P1 [label="Audio Normalization\n(16kHz sampling)", fillcolor="#E0FFFF"];
        P2 [label="Noise Reduction\n(Spectral Subtraction)", fillcolor="#E0FFFF"];
        P3 [label="Silence Removal\n(VAD)", fillcolor="#E0FFFF"];
        P4 [label="Segmentation\n(Verse/Ayah level)", fillcolor="#E0FFFF"];
    }
    
    // Feature Extraction
    subgraph cluster_features {
        label="Feature Extraction";
        style=filled;
        color="#FFF0F5";
        
        F1 [label="MFCC Extraction\n(13 coefficients)", fillcolor="#FFE4E1"];
        F2 [label="Mel-Spectrogram\nGeneration", fillcolor="#FFE4E1"];
        F3 [label="Delta & Delta-Delta\nFeatures", fillcolor="#FFE4E1"];
    }
    
    // Parallel Processing
    subgraph cluster_parallel {
        label="Parallel Analysis";
        style=filled;
        color="#F0E68C";
        
        A1 [label="ASR Transcription\nâ†’ Arabic Text", fillcolor="#FFFFE0"];
        A2 [label="Tajweed Rule\nDetection", fillcolor="#FFFFE0"];
        A3 [label="Makhraj Point\nVerification", fillcolor="#FFFFE0"];
        A4 [label="Prosody Analysis\n(Pitch, Duration)", fillcolor="#FFFFE0"];
    }
    
    // Error Analysis
    subgraph cluster_errors {
        label="Error Detection & Analysis";
        style=filled;
        color="#FFB6C1";
        
        E1 [label="Compare with\nGround Truth", fillcolor="#FFC0CB"];
        E2 [label="Identify Error\nLocations", fillcolor="#FFC0CB"];
        E3 [label="Classify Error\nTypes", fillcolor="#FFC0CB"];
        E4 [label="Calculate\nConfidence Scores", fillcolor="#FFC0CB"];
    }
    
    // Feedback Generation
    subgraph cluster_feedback {
        label="Feedback Generation";
        style=filled;
        color="#DDA0DD";
        
        FB1 [label="Generate Detailed\nError Report", fillcolor="#EE82EE"];
        FB2 [label="Retrieve Reference\nAudio Clips", fillcolor="#EE82EE"];
        FB3 [label="Create Visual\nFeedback", fillcolor="#EE82EE"];
        FB4 [label="Calculate Overall\nScore", fillcolor="#EE82EE"];
    }
    
    // Output
    OUTPUT [label="Present Results\nto User", fillcolor="#98FB98"];
    END [label="User Reviews\nFeedback", shape=ellipse, fillcolor="#90EE90"];
    
    // Flow connections
    START -> INPUT;
    INPUT -> P1;
    P1 -> P2;
    P2 -> P3;
    P3 -> P4;
    
    P4 -> F1;
    P4 -> F2;
    F1 -> F3;
    
    F1 -> A1;
    F2 -> A2;
    F3 -> A3;
    F2 -> A4;
    
    A1 -> E1;
    A2 -> E1;
    A3 -> E1;
    A4 -> E1;
    
    E1 -> E2;
    E2 -> E3;
    E3 -> E4;
    
    E4 -> FB1;
    E4 -> FB2;
    E4 -> FB3;
    E4 -> FB4;
    
    FB1 -> OUTPUT;
    FB2 -> OUTPUT;
    FB3 -> OUTPUT;
    FB4 -> OUTPUT;
    
    OUTPUT -> END;
}